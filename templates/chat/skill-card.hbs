<div class="skill-card sheet-card" data-type="{{data.type}}">
  <div class="torgeternity-message-header flexrow">
    <img class="message-header torgeternity-actor-icon" src="{{actorPic}}" data-tooltip="{{actorName}}"
      data-action="openSheet" data-actor="{{actor}}" />

    <div class="message-header torgeternity-skill-description flexcol">
      {{#if unskilledTest}}
        <p class="skill-chat-title unskilled">{{chatTitle}}</p>
        <p class="skill-unskilled-label">{{localize 'torgeternity.chatText.unskilled'}}</p>
      {{else}}
        <p class="skill-chat-title skilled">{{chatTitle}}</p>
      {{/if}}
    </div>
  </div>
  <div class="chat-text" style="padding:0px">
    <p class="skill-roll-result" style="{{resultTextStyle}}">
      {{resultText}}
    </p>
    {{#if extraResult}}
      <p class="skill-roll-disconnect-label"> {{{extraResult}}} </p>
    {{/if}}
    {{#if disconnection}}
      <p class="skill-roll-disconnect-label">
        {{disconnection}}
      </p>
      <ul class="skill-roll-disconnect-label axioms">
        {{#each disconnectionPerks}}
          <li> {{this}}</li>
        {{/each}}
        {{#each disconnectionZone}}
          <li> {{this}}</li>
        {{/each}}
        {{#each disconnectionActor}}
          <li>{{this}}</li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if successfulDefendApprovedAction}}
      <p class="skill-roll-approved-action">
        {{localize 'torgeternity.chatText.check.isApprovedDefend' name=target.targetName}}
        <a class="button roll-button drawDestiny" data-action="drawDestiny"
          data-actor="{{target.id}}">{{localize 'torgeternity.dialogPrompts.drawDestiny'}}</a>
      </p>
    {{/if}}
    {{#if successfulApprovedAction}}
      <p class="skill-roll-approved-action">{{localize 'torgeternity.chatText.check.isApprovedAction'}}
        <a class="button roll-button drawDestiny" data-action="drawDestiny"
          data-actor="{{actor}}">{{localize 'torgeternity.dialogPrompts.drawDestiny'}}</a>
      </p>
    {{/if}}
    {{#if isDefeatTest}}
      <p class="skill-roll-defeat defeat-main">
        <a class="defeat" data-action="applyDefeat"
          data-result="{{result}}">{{{defeatMain}}}</a>
      </p>
      <p class="skill-roll-defeat defeat-sub">{{{defeatSub}}}</p>
      </p>
    {{/if}}
    <details class="chatCardDetailsElement" {{isOpen}}>
      <summary class="skillcardSummaryElement"
        data-open="{{localize 'torgeternity.chatText.hideDetails'}}"
        data-close="{{localize 'torgeternity.chatText.showDetails'}}">
        <p class="skill-roll-action-label">{{localize 'torgeternity.chatText.check.result.diceTotal'}}
          {{combinedRollTotal}}
        </p>
        {{#if actionTotalContent}}
          <p class="skill-roll-action-label">{{actionTotalContent}}</p>
        {{/if}}
      </summary>
      <table class=" skill-roll-table">
        <tr>
          <td>{{typeLabel}}:</td>
          <td>{{skillValue}}</td>
        </tr>
        <tr style="border:1px solid black">
          <td>{{localize 'torgeternity.chatText.dieTotal'}}</td>
          <td>{{combinedRollTotal}}</td>
        </tr>
        <tr>
          <td>{{localize 'torgeternity.chatText.bonus'}}:</td>
          <td>
            <div>{{numberFormat bonus sign=true}}</div>
          </td>
        </tr>
        <tr>
          <td>
            <a class="modifier-label" data-action="modifierLabel">{{localize 'torgeternity.chatText.modifiers'}}</a>:
          </td>
          <td>
            <div data-tooltip-html="{{modifierText}}">{{numberFormat modifiers sign=true}}</div>
          </td>
        </tr>
        {{#if cardsPlayed}}
          <tr>
            <td>
              {{localize 'torgeternity.chatText.bonusCard'}}:
            </td>
            <td>
              <div>{{cardsPlayed}}</div>
            </td>
          </tr>
        {{/if}}

        {{#if chatNote}}
          <tr>
            <td>
              {{localize 'torgeternity.chatText.notes'}}:
            </td>
            <td>
              <div>{{{chatNote}}}</div>
            </td>
          </tr>
        {{/if}}
        {{#if ammoCount}}
          <tr>
            <td>
              {{localize 'torgeternity.chatText.ammoLabel'}}:
            </td>
            <td>
              <div>{{ammoCount}}</div>
            </td>
          </tr>
        {{/if}}
      </table>
      <!-- full copy from core, d20 fixed for diceform, handle explosion skin or not with if equal tests -->
      <div class="message-content">
        <div class="dice-roll-torg">
          <div class="dice-result">
            <div class="dice-tooltip expanded" style="display: block;">
              <section class="tooltip-part">
                <div class="dice">
                  <ol class="dice-rolls">
                    {{#each diceList}} <!-- Array created in torgcheck -->
                      <li
                        class="roll die d20 {{#if this.exploded}}exploded{{/if}}"
                        {{#if
                        @root.torgDiceStyle}}style="background-image: url(systems/torgeternity/images/Torgd20.svg);"
                        {{/if}}>
                        {{{this.result}}}{{#if this.manual}}<span class="manualRoll">M</span>
                        {{/if}}
                      </li>
                    {{/each}}
                    {{#if bonusDiceList}}
                      {{#each bonusDiceList}} <!-- Array created in torgcheck -->
                        <li class="roll die d6">
                          {{#if this.exploded}}&infin;{{else}}{{{this.result}}}{{/if}}{{#if this.manual}}<span
                              class="manualRoll">M</span>{{/if}}
                        </li>
                      {{/each}}
                    {{/if}}
                  </ol>
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </details>

    {{#if possibleGlory}}
      <div class="possible-glory">
        <p>{{localize 'torgeternity.chatText.possibleGlory'}}</p>
      </div>
    {{/if}}

    {{#if ownsActor}}
      {{#unless (and hideFavButton hidePlus3 (eq possibilityStyle 'hidden') (eq upStyle 'hidden') (eq heroStyle 'hidden') (eq dramaStyle 'hidden') )}}
        <div class="skill-roll-menu">
          {{#unless hideFavButton}}
            <a class="button roll-button" data-action="rollFav">{{localize 'torgeternity.chatText.favored'}}</a>
          {{/unless}}
          <a class="button roll-button {{possibilityStyle}}" data-action="rollPossibility"
            data-tooltip="{{localize 'torgeternity.chatText.possibilityTooltip'}}">{{localize 'torgeternity.chatText.possibility'}}</a>
          <a class="button roll-button {{upStyle}}"
            data-action="rollUp">{{localize 'torgeternity.chatText.up'}}</a>
          <a class="button roll-button {{heroStyle}}"
            data-action="rollHero">{{localize 'torgeternity.chatText.hero'}}</a>
          <a class="button roll-button {{dramaStyle}}"
            data-action="rollDrama">{{localize 'torgeternity.chatText.drama'}}</a>
          {{#unless hidePlus3}}
            <a class="button roll-button" data-action="addPlus3">{{localize 'torgeternity.chatText.bonusCard'}}</a>
          {{/unless}}
        </div>
      {{/unless}}

      {{#if (and ownsActor (or showApplySoak showActorApplyVeryVulnerable showBacklashButtons))}}
        <p class="applyButtons">
          {{#if showApplySoak}}
            <a class="button roll-button" data-action="applySoak"
              data-tooltip="{{localize 'torgeternity.sheetLabels.applySoakTooltip'}}">
              {{localize 'torgeternity.sheetLabels.applySoak'}}</a>
          {{/if}}
          {{#if showActorApplyVeryVulnerable}}
            <a class="button roll-button" data-action="applyActorVulnerable"
              data-tooltip="{{localize 'torgeternity.sheetLabels.applyVulnerableTooltip'}}">
              {{localize 'torgeternity.sheetLabels.applyVulnerable'}}</a>
          {{/if}}
          {{#if showBacklashButtons}}
            <a class="button roll-button" data-action="backlash1"
              data-tooltip="{{localize 'torgeternity.sheetLabels.backlash1Tooltip'}}">
              {{localize 'torgeternity.sheetLabels.backlash1'}}</a>
            <a class="button roll-button" data-action="backlash2"
              data-tooltip="{{localize 'torgeternity.sheetLabels.backlash2Tooltip'}}">
              {{localize 'torgeternity.sheetLabels.backlash2'}}</a>
            <a class="button roll-button" data-action="backlash3"
              data-tooltip="{{localize 'torgeternity.sheetLabels.backlash3Tooltip'}}">
              {{localize 'torgeternity.sheetLabels.backlash3'}}</a>
          {{/if}}
        </p>
      {{/if}}
    {{/if}}

    {{#if (or targetPresent isAttack)}}
      <div class="skill-roll-target-list">
        {{#each targetAll}}
          <li class="skill-roll-target" data-token-uuid="{{this.uuid}}">
            {{#if this.targetName}}
              <div class="target-header">
                <span class="name" data-action="panToTarget"><i
                    class="icon fa-solid {{ifThen (eq type 'stormknight') 'fa-person' 'fa-ghost'}}"></i>&nbsp;{{this.targetName}}
                </span>
                {{#unless this.dummyTarget}}<span class="controls"><a data-action="pingTarget"
                      data-tooltip="{{localize 'torgeternity.chatText.pingToken'}}"><i
                        class="fa-solid fa-fw fa-signal-stream"></i></a></span>{{/unless}}
              </div>
            {{/if}}
            <!-- <img class="target-icon" src="{{this.targetPic}}"
              data-tooltip="{{this.targetName}}" data-action="openSheet" data-actor="{{this.id}}" /> -->
            <div class="target-details">
              {{#if this.actionTotalContent}}
                <p class="skill-roll-action-label actionTotalContent">{{this.actionTotalContent}}</p>
              {{/if}}
              {{#if this.damageSubDescription}}
                <p class="skill-roll-action-label damageSubDescription">{{this.damageSubDescription}}</p>
              {{/if}}
              {{#if this.bdDamageSum}}
                <p class="skill-roll-action-label bdDamageSum">
                  {{localize 'torgeternity.chatText.check.result.BDDamageSum' count=this.amountBD total=this.bdDamageSum}}
                </p>
              {{/if}}
              {{#if this.damageDescription}}
                {{#if this.soakDescription}}
                  <p class="skill-roll-damage-label soakDescription">
                    {{this.soakDescription}}
                  </p>
                {{/if}}
                <p class="skill-roll-damage-label damageDescription">
                  {{this.damageDescription}}
                </p>
              {{/if}}

              {{#if (or (and @root.ownsActor this.showBD) (and this.ownsTarget (or this.showApplyDamage this.showApplyEffects this.showApplyStymied this.showApplyVulnerable)))}}
                <p class="applyButtons">
                  {{#if (and @root.ownsActor this.showBD)}}
                    <a class="button roll-button showBD" data-action="addBd"
                      data-tooltip="{{localize 'torgeternity.chatText.bdTooltip'}}">{{localize 'torgeternity.chatText.bonusDice'}}</a>
                  {{/if}}
                  {{#if this.ownsTarget}}
                    {{#if this.showApplyDamage}}
                      {{#unless this.soakWounds}}
                        <a class="button roll-button" data-action="soakDam"
                          data-tooltip="{{localize 'torgeternity.sheetLabels.soakDamageTooltip'}}">
                          {{localize 'torgeternity.sheetLabels.soakDamage'}}</a>
                      {{/unless}}
                      <a class="button roll-button" data-action="applyDam"
                        data-tooltip="{{localize 'torgeternity.sheetLabels.applyDamageTooltip'}}">
                        {{localize 'torgeternity.sheetLabels.applyDamage'}}</a>
                    {{/if}}
                    {{#if this.showApplyEffects}}
                      <a class="button roll-button" data-action="applyEffects"
                        data-tooltip="{{localize 'torgeternity.sheetLabels.applyEffectsTooltip'}}">
                        {{localize 'torgeternity.sheetLabels.applyEffects'}}</a>
                    {{/if}}
                    {{#if this.showApplyStymied}}
                      <a class="button roll-button" data-action="applyStymied"
                        data-tooltip="{{localize 'torgeternity.sheetLabels.applyStymiedTooltip'}}">
                        {{localize 'torgeternity.sheetLabels.applyStymied'}}</a>
                    {{/if}}
                    {{#if this.showApplyVulnerable}}
                      <a class="button roll-button" data-action="applyVulnerable"
                        data-tooltip="{{localize 'torgeternity.sheetLabels.applyVulnerableTooltip'}}">
                        {{localize 'torgeternity.sheetLabels.applyVulnerable'}}</a>
                    {{/if}}
                  {{/if}}
                </p>
              {{/if}}
            </div>
          </li>
        {{/each}}
      </div>
    {{/if}}
  </div>
</div>